# World（世界）的设定

整个世界被称为“TANAPOCIA”，在这个世界中的意思就是“整个世界”。所有的居民都生活在世界中，而每个居民又因躯体限制而生存于特定的区域。比如人只会在村庄、城镇以及近郊活动；中立生物只会在很小的一片区域活动；怪兽会在黑暗领地活动。具体的地图见地图设定集。

## 世界引擎（时间同步和异步管理）World Engine

世界引擎会确保所有的居民的活动都是同步进行的。如果世界引擎的计算能力无法达到同步运行所有居民的活动，那么世界引擎将进入一个特殊的运算状态：所有居民的活动会被放入一个计算队列，这个队列代表的是一个时间步下的所有活动。当所有活动计算完毕后，世界时钟才进入下一个时间步。

世界引擎管理所有的物理法则，比如碰撞系统等。

世界引擎是自上而下的设计，居民无论如何都无法改变，类似于人类世界的物理体系，重力和化学反应等都不会因人的意志而改变。

在Godot中，你可以创建一个全局的单例脚本（在Godot中称为 `Autoload`），这就是你的 `WorldEngine`。这个引擎可以控制游戏的主循环。当它决定推进一个 `time step`时，它会向所有居民（NPC节点）发出一个信号，比如 `"request_action"`。然后引擎会等待，直到所有居民都计算并返回了它们的下一步行动，再统一执行这些行动。这完美地解决了LLM可能带来的延迟问题。

## 世界时钟（时间系统）World Clock

整个世界由一个时钟控制，所有的居民的行动都无法跳脱出时间系统（即世界时钟的约束）。世界从1年1月1日0时0分0秒开始，每一个小时被称为一个时间步（time step）。当人类玩家进入游戏世界的时候，游戏速度会和人类世界同步；而当人类玩家登出游戏世界后，游戏世界将进入加速状态。加速状态根据情况的不同，可能是1分钟=人类世界1s，也可能是1小时=人类世界1s，取决于世界引擎的计算能力。

这同样可以在 `WorldEngine`这个全局脚本中实现。它就是一个计时器，根据当前是否有玩家在线，来调整时间流逝的速度（即调整每个 `time step`之间的现实世界间隔）。实现起来非常直接。

## 知识系统 Knowledge System

知识系统包含常识和和相关的书籍中也会反复提及这些知识：

* 常识（Common Sense）：比如火是热的，太阳东升西落，黑暗领域不能进去等。常识数据库是被强制记录而无法删除的。
* 领域知识（Domain Knowledge）：关于这个世界的历史、地理、文化、种族、传说、神袛等。一个居民不一定天生就知道这些知识，但是在图书馆、和父母及邻居或者同事的交流中，这些内容会被传递。领域知识会作为一个数据库存在，每个居民都可以通过交流、学习、阅读灯不断探索领域知识。

这里要注意，黑暗领域不能进去被单独设定为常识，而非世界引擎，是因为人类不能到黑暗领域是一种知识而非法则。换句话说，能否出现一个人通过思考来做出进入黑暗领域的事情也是该实验要观测的一个重要内容。

领域知识可以通过**交互**（交流、阅读）来填充的。这为居民的“成长”和“探索”行为提供了核心驱动力。一个居民可能会为了了解古代传说（探索领域知识）而特意去图书馆（产生行动），并在那里遇到其他人（触发新的交互和记忆）。
